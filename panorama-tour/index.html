<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>StudioGoboVirtualTour</title>
  <!-- Фиксированная версия Pannellum -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/pannellum@2.5.6/build/pannellum.css">
  <script src="https://cdn.jsdelivr.net/npm/pannellum@2.5.6/build/pannellum.js"></script>
  <style>
    html,body{height:100%;margin:0;background:#000}
    #panorama{width:100%;height:100%}
    .pnlm-hotspot { background: none !important; }
    .pnlm-tooltip{background:rgba(0,0,0,.85);color:#fff;padding:6px 8px;border-radius:6px;font:14px/1.3 system-ui;max-width:260px}
    .dot {
      width: 26px;
      height: 26px;
      border-radius: 50%;
      background: rgba(255,255,255,0.5);}
    .dot.nav {border: 2px solid white;}
    .dot.info {border: none;}

  </style>
</head>
<body>
  <div id="panorama"></div>

  <script>
    // Лог ошибок на экран, чтобы видеть причину
    window.onerror = (msg, src, line, col, err) => {
      const box = document.createElement('div');
      box.style.cssText = 'position:fixed;top:10px;left:10px;background:#c00;color:#fff;padding:6px 8px;z-index:9999;border-radius:6px;max-width:90vw;font:12px monospace';
      box.textContent = 'JS error: ' + msg;
      document.body.appendChild(box);
      console.error(msg, src, line, col, err);
    };

    // Минимальная конфигурация без "..." и прочего
    var common = {
      type: "equirectangular",
      autoLoad: true,
      hfov: 100,
      minHfov: 50,
      maxHfov: 120
    };

    var viewer = pannellum.viewer('panorama', {
      "default": { "firstScene": "studio1", "sceneFadeDuration": 400, "autoLoad": true },
      "scenes": {
        "studio1": {
          "type": common.type,
          "autoLoad": common.autoLoad,
          "hfov": common.hfov, "minHfov": common.minHfov, "maxHfov": common.maxHfov,
          "panorama": "p21fin.jpg",
          "hotSpots": [ 
            { pitch: 30,  yaw: 30,  type:"scene", sceneId:"studio2", text:"Studio 2", createTooltipFunc: makeDot, createTooltipArgs:{ kind:'nav' } },
            { pitch: 0,  yaw: 0, type:"info", text:"Доп. услуга — бумажные фоны. 500 дин.", createTooltipFunc: makeDot, createTooltipArgs:{ kind:'info' } }
          ]
        },
        "studio2": {
          "type": common.type,
          "autoLoad": common.autoLoad,
          "hfov": common.hfov, "minHfov": common.minHfov, "maxHfov": common.maxHfov,
          "panorama": "p22fin.jpg",
          "hotSpots": [
            { pitch: 3,  yaw:-180, type:"scene", sceneId:"studio1", text:"Studio 1", createTooltipFunc: makeDot, createTooltipArgs:{ kind:'nav' } },
            { pitch:-5,  yaw: 70, type:"info", text:"Постоянный свет SL150 — входит в аренду", createTooltipFunc: makeDot, createTooltipArgs:{ kind:'info' } }
          ]
        }
      }
    });

    // Для диагностики: покажем процесс загрузки
    viewer.on('load', () => console.log('Pannellum loaded first frame'));
    viewer.on('error', (e) => {
      const box = document.createElement('div');
      box.style.cssText = 'position:fixed;top:40px;left:10px;background:#d97706;color:#000;padding:6px 8px;z-index:9999;border-radius:6px;max-width:90vw;font:12px monospace';
      box.textContent = 'Pannellum error: ' + e?.message;
      document.body.appendChild(box);
      console.error('Pannellum error:', e);
    });
    function makeDot(hotSpotDiv, args){
      hotSpotDiv.classList.add('dot');
      hotSpotDiv.classList.add(args?.kind === 'nav' ? 'nav' : 'info');
    };
  </script>
</body>
</html>
